#!/usr/bin/env node

import fs from 'node:fs';
import path from 'node:path';

const root = path.resolve(path.dirname(new URL(import.meta.url).pathname), '..');
const rulesPath = path.join(root, 'rules.json');
const outPath = path.join(root, 'lint-rules.md');

if (!fs.existsSync(rulesPath)) {
  process.stderr.write(`ERROR: missing rules.json: ${rulesPath}\n`);
  process.exit(2);
}

let rules;
try {
  rules = JSON.parse(fs.readFileSync(rulesPath, 'utf8'));
} catch (e) {
  process.stderr.write(`ERROR: failed to parse rules.json: ${rulesPath}\n${e?.message || e}\n`);
  process.exit(2);
}

if (!Array.isArray(rules)) {
  process.stderr.write('ERROR: rules.json must be an array\n');
  process.exit(2);
}

const lines = [];
lines.push('# OpenClaw ConfigGen â€” Lint Rules');
lines.push('');
lines.push('> AUTO-GENERATED from `rules.json`. Do not edit this file by hand.');
lines.push('');
lines.push('Format: `id` / `category` / `severity` / `name` / `fix`');
lines.push('');

for (const r of rules) {
  const id = r?.id || '';
  const cat = r?.category || '';
  const sev = r?.severity || '';
  const name = r?.name || '';
  const fix = r?.fix || '';
  lines.push(`## ${id}: ${name}`);
  lines.push('');
  if (cat) lines.push(`- Category: **${cat}**`);
  lines.push(`- Severity: **${sev}**`);
  if (fix) lines.push(`- Fix: ${fix}`);
  lines.push('');
}

fs.writeFileSync(outPath, lines.join('\n'), 'utf8');
process.stdout.write(`Wrote ${outPath}\n`);
